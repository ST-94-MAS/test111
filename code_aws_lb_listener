4.	コマンド一覧
4.1.	薬局スペースの作成
hi-create-user -n <ユーザー名>
薬局スペースを作成するときに実行します。
実行すると、薬局スペースを作成するRDSインスタンスを指定する選択肢が表示され、薬局スペースを作るための処理が実行されます。途中で中断しないでください。
ユーザー名は「’」(シングルクォーテーション)で囲って下さい。入力したユーザー名はメール通知に記載されます。
実行が成功すれば薬局IDなどの情報を記載したメールが送信されます。
1つのRDSインスタンスに作成できる薬局数には上限（4.2参照）があり、上限を超えて薬局スペースを作成しようとすると中断されます。上限に達していないRDSインスタンスを指定するか、新しいRDSインスタンスを用意する必要がある場合は、クラウドの運用管理者に依頼してください。
e.g.
hi-create-user -n ‘1234_ハイブリッジ薬局’
4.2.	RDSインスタンスあたりの薬局数を取得
hi-get-userdb-count [-d <RDSインスタンスID>]
指定のRDSインスタンスに存在する薬局数を取得します。薬局スペースを作成した時点でカウントに数えられます。
1つのRDSインスタンスに作成できる薬局数には上限があります。「開発・テスト環境で27」「本番環境で97」です。
<RDSインスタンス>を省略したときは、選択肢が表示されます。
e.g.
hi-get-userdb-count -d user-0003
4.3.	データA適用（ver1移行フロー用）
hi-init-user -u <薬局ID>
ver1移行フローでデータAがアップロードされたあと、クラウド上にデータAを適用するときに実行します。
画像数が多いと非常に時間がかかる事があります。
e.g.
hi-init-user -u u-2fc10ee9-851f-4429-89cf-0c050f435fe7
4.4.	データB適用（ver1移行フロー用）
hi-init-userimages -u <薬局ID>
ver1移行フローでデータBがアップロードされたあと、クラウド上にデータBを適用するときに実行します。
e.g.
hi-init-userimages -u u-2fc10ee9-851f-4429-89cf-0c050f435fe7
4.5.	移行完了コマンド(ver1移行フロー用)
hi-complete-user -u <薬局ID>
ver1移行フローで移行か完了したら実行します。
このコマンドを実行するまで、薬局のDBは「アップデート対象外」になります。
e.g.
hi-complete-user -u u-2fc10ee9-851f-4429-89cf-0c050f435fe7
4.6.	端末登録
hi-add-device -u <薬局ID> -r <リクエストID>
端末登録を行うときに実行します。
e.g.
hi-add-device -u u-2fc10ee9-851f-4429-89cf-0c050f435fe7 -r 1234567
4.7.	端末削除
hi-delete-device -d <端末ID>
指定したIDの端末をクラウドへ接続できないようにします。
e.g.
hi-delete-device -d d-dc8ffaed-f609-4679-8b58-1967745f868a
4.8.	リクエストIDから薬局IDと端末IDを調べる
hi-get-deviceid -r <リクエストID>
端末登録時に使用したリクエストIDから薬局IDと端末IDを取得します。
リクエストIDは長期間で重複する可能性があるため、複数の結果が表示される可能性があります。
e.g.
hi-get-deviceid -r 1234567
4.9.	端末リクエスト情報取得
hi-get-device-requestinfo -r <リクエストID>
クライアント端末から送られた端末リクエスト情報を調べるときに実行します。
あまり使うことはありませんが、実際にクラウド上に登録リクエストが送られたのかどうか調べることができます。
端末リクエスト情報は一週間で削除されます。
e.g.
hi-get-device-requestinfo -r 1234567
4.10.	指定薬局DBのバックアップ
hi-backup-userdb -u <薬局ID> -k <キーワード>
指定の薬局のDBをS3にバックアップします。キーワードは後で復元するときに利用します。
e.g.
hi-backup-userdb -u u-2fc10ee9-851f-4429-89cf-0c050f435fe7 -k 21.12
4.11.	指定薬局DBの復元
hi-restore-userdb -u <薬局ID> -k <キーワード>
事前にS3にバックアップしていたDBを復元します。先にDBを削除しておく必要があります。
本番環境で使用することはまずありません。
e.g.
hi-restore-userdb -u u-2fc10ee9-851f-4429-89cf-0c050f435fe7 -k 21.12
4.12.	共通DBと添付文書のアップデート
hi-update-usercommondb -v <バージョン番号>
Dix、Contents、HisFilesのDBを指定バージョンのものに復元し、指定バージョンの添付文書PDFをユーザーが閲覧できるように公開します。
復元中にユーザーがこれらのDBにアクセスすると落ちるため、運用時間外に行う必要があります。
古いバージョンを指定する事もできますので、バージョン番号の指定には注意してください。
e.g.
hi-update-usercommondb -v 22.1
4.13.	RDSインスタンスの共通DBのアップデート
hi-update-instance-usercommondb [-I <RDSインスタンスID>]-v <バージョン番号>
指定したRDSインスタンスにあるDix、Contents、HisFilesのDBを指定バージョンのものに復元します。
「hi-update-usercommondb」コマンドを使って本番環境の全共通DBを順次アップデートすると時間がかかるため、RDSインスタンス別に並列実行でDBをアップデートし、アップデートにかかる時間を短縮する目的で利用します。
復元中にユーザーがこれらのDBにアクセスすると落ちるため、運用時間外に行う必要があります。
古いバージョンを指定する事もできますので、バージョン番号の指定には注意してください。
<RDSインスタンス>を省略したときは、選択肢が表示されます。
e.g.
hi-update-instance-usercommondb -i user-0003 -v 22.1
4.14.	添付文書のアップデート
hi-update-medicinepdf -v <バージョン番号>
指定バージョンの添付文書PDFをユーザーが閲覧できるように公開します。
「hi-update-instance-usercommondb」でRDSインスタンス個別に共通DBをアップデートしたあと、添付文書だけアップデートする目的で利用します。
e.g.
hi-update-medicinepdf -v 22.1
4.15.	全ユーザーDBのアップデート
hi-update-all-userdb --from <現バージョン番号> --to <新バージョン番号>
全ユーザーのDBを指定の「旧バージョン」から「新バージョン」にアップデートします。
開発、もしくは品管が事前にアップロードしている新バージョン用のSQLが順に適用されます。
旧移行フローで「データAアップロード、データB未アップロード」の状態のDBはアップデートされません。
バージョン飛ばしはできませんので注意してください。現バージョン番号を指定する必要があるのは間違い防止チェックのためです。
e.g.
hi-update-all-userdb --from 21.12 --to 22.1
4.16.	RDSインスタンスに所属しているユーザーDBのアップデート
hi-update-instance-userdb [-i <RDSインスタンスID>] --from <現バージョン番号> --to <新バージョン番号>
指定したRDSインスタンスに所属しているユーザーDBを全てアップデートします。
「hi-update-all-userdb」コマンドを使って本番環境の全ユーザーを順次アップデートすると時間がかかるため、RDSインスタンス別に並列実行でユーザーDBをアップデートし、アップデートにかかる時間を短縮する目的で利用します。
※	このコマンドを使って全ユーザーのDBをアップデートした場合、最後に必ず「hi-update-all-userdb」コマンドを実行してください。
「hi-update-all-userdb」コマンドで管理DBに定義しているユーザーDBの現在最新バージョンが更新されるのと、特定のRDSインスタンスのユーザーDBだけが更新されていない状態を防止するためです。既にアップデートされているユーザーDBはスキップされます。
<RDSインスタンス>を省略したときは、選択肢が表示されます。
e.g.
hi-update-instance-userdb -i user-0003 --from 21.12 --to 22.1
4.17.	個別ユーザーDBのアップデート
hi-update-userdb -u <薬局ID> --from <現バージョン番号> --to <新バージョン番号>
特定のユーザーDBだけアップデートします。
旧フローでの移行中に利用することが大半です。
バージョン飛ばしはできませんので注意してください。現バージョン番号を指定する必要があるのは間違い防止チェックのためです。
e.g.
hi-update-userdb --from 21.12 --to 22.1
4.18.	クライアントプログラムの配信日設定
hi-add-new-client-version –-date <配信日> --version <バージョン番号>
クライアントプログラムの配信日を設定します。
「--version」には、開発、もしくは品管が事前にアップロードしている新バージョン用のプログラムのバージョン番号を指定してください。
「--date」は「YYYYMMdd」形式です。UTCですので、たとえば「20210101」を指定すると、日本時間で2021/1/1 9:00にプログラムが配信されます。
過去日を設定すると即配信されます。
例えば、アップデート作業を「2021/2/1の22時」に行っていた場合、次の日に配信したければ「20210201」を指定すれば即配信され、動作確認が行えます。
e.g.
hi-add-new-client-version –-date 20220215 --version 22.1
4.19.	薬局スペースの削除
hi-delete-user -u <薬局ID> [-f]
※	指定の薬局のデータが完全に削除されます。本番環境で使うことはまずありません。
指定の薬局のDB、画像、アカウント、DNSの設定などを完全に削除します。指定の薬局に端末が紐づいていると削除できません。
「-f」を指定すると端末が紐づいていても強制的に削除します。
4.20.	サンクスネットデータ回収
hi-thanks-collect –-type <データ名>
ユーザーDBに保存されているサンクスネット関連のデータを収集します。詳細は「サンクスネットデータ回収・クラウド版.docx」を参照してください。
4.21.	端末情報の収集
hi-collect-user-deviceinfo
ユーザーDBに保存されている端末の情報（OS情報など）を収集して、S3バケット：s3://users-common-${HI_CLOUD_S3_SUFFIX}/user_device_infocollect/user_device_info.csvに出力します。
4.22.	ユーザーDBのRDSインスタンスを移動する
hi-move-userdb -u <薬局ID> [-i <移動先のRDSインスタンスID>]
稼働しているユーザーDBを別のRDSインスタンスへ移動します。
負荷の高いDBを別のRDSインスタンスへ移動することで、RDSインスタンスにかかる負荷を分散させることができます。
クラウドのみで完結するので、クライアントの作業は発生しません。
移動させる薬局のDBが一時的に使用できなくなるため、薬局の業務中に実施しないようにしてください。
e.g.
hi-move-userdb -u u-2fc10ee9-851f-4429-89cf-0c050f435fe7
4.23.	薬局のコピー
hi-copy-user -n <新しいユーザー（薬局）名> [-i <コピー先のRDSインスタンスID>]
新しい薬局スペースを作成し、コピー元の薬局スペースにあるユーザーDBと画像を新しい薬局スペースにコピーします。画像のコピーは非同期で行われ、時間がかかる場合があります。
4.24.	全RDSインスタンスのスナップショット作成
hi-create-rds-snapshot -k <キーワード> [--wait]
管理DB、及びユーザーDBを配置している全てのRDSインスタンスのスナップショットを{DBインスタンス名}
